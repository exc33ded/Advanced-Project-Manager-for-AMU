{% extends "admin/base_admin.html" %}

{% block content %}
    <h2>Tasks for Project: {{ project.title }}</h2>

    <!-- Backlog Tasks -->
    <h3>Backlog</h3>
    <ul>
        {% for task in backlog_tasks %}
            <li>
                <strong>{{ task.title }}</strong> - Due: {{ task.due_date.strftime('%Y-%m-%d') }}
                <form action="{{ url_for('admin_routes.delete_task', task_id=task.id) }}" method="POST" style="display:inline;">
                    <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                </form>
                <a href="{{ url_for('admin_routes.edit_task', task_id=task.id) }}" class="btn btn-primary btn-sm">Edit</a>
                <form action="{{ url_for('admin_routes.move_task', task_id=task.id) }}" method="POST" style="display:inline;">
                    <select name="status" onchange="this.form.submit()">
                        <option value="Backlog" {% if task.status == 'Backlog' %} selected {% endif %}>Backlog</option>
                        <option value="In Progress" {% if task.status == 'In Progress' %} selected {% endif %}>In Progress</option>
                        <option value="Progressed" {% if task.status == 'Progressed' %} selected {% endif %}>Progressed</option>
                        <option value="Finished" {% if task.status == 'Finished' %} selected {% endif %}>Finished</option>
                    </select>
                </form>
            </li>
        {% endfor %}
    </ul>

    <!-- In Progress Tasks -->
    <h3>In Progress</h3>
    <ul>
        {% for task in in_progress_tasks %}
            <li>
                <strong>{{ task.title }}</strong> - Due: {{ task.due_date.strftime('%Y-%m-%d') }}
                <form action="{{ url_for('admin_routes.delete_task', task_id=task.id) }}" method="POST" style="display:inline;">
                    <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                </form>
                <a href="{{ url_for('admin_routes.edit_task', task_id=task.id) }}" class="btn btn-primary btn-sm">Edit</a>
                <form action="{{ url_for('admin_routes.move_task', task_id=task.id) }}" method="POST" style="display:inline;">
                    <select name="status" onchange="this.form.submit()">
                        <option value="Backlog" {% if task.status == 'Backlog' %} selected {% endif %}>Backlog</option>
                        <option value="In Progress" {% if task.status == 'In Progress' %} selected {% endif %}>In Progress</option>
                        <option value="Progressed" {% if task.status == 'Progressed' %} selected {% endif %}>Progressed</option>
                        <option value="Finished" {% if task.status == 'Finished' %} selected {% endif %}>Finished</option>
                    </select>
                </form>
            </li>
        {% endfor %}
    </ul>

    <!-- Progressed Tasks -->
    <h3>Progressed</h3>
    <ul>
        {% for task in progressed_tasks %}
            <li>
                <strong>{{ task.title }}</strong> - Due: {{ task.due_date.strftime('%Y-%m-%d') }}
                <form action="{{ url_for('admin_routes.delete_task', task_id=task.id) }}" method="POST" style="display:inline;">
                    <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                </form>
                <a href="{{ url_for('admin_routes.edit_task', task_id=task.id) }}" class="btn btn-primary btn-sm">Edit</a>
                <form action="{{ url_for('admin_routes.move_task', task_id=task.id) }}" method="POST" style="display:inline;">
                    <select name="status" onchange="this.form.submit()">
                        <option value="Backlog" {% if task.status == 'Backlog' %} selected {% endif %}>Backlog</option>
                        <option value="In Progress" {% if task.status == 'In Progress' %} selected {% endif %}>In Progress</option>
                        <option value="Progressed" {% if task.status == 'Progressed' %} selected {% endif %}>Progressed</option>
                        <option value="Finished" {% if task.status == 'Finished' %} selected {% endif %}>Finished</option>
                    </select>
                </form>
            </li>
        {% endfor %}
    </ul>

    <!-- Finished Tasks -->
    <h3>Finished</h3>
    <ul>
        {% for task in finished_tasks %}
        <li>
            <strong>{{ task.title }}</strong> - Due: {{ task.due_date.strftime('%Y-%m-%d') }}
            <form action="{{ url_for('admin_routes.delete_task', task_id=task.id) }}" method="POST" style="display:inline;">
                <button type="submit" class="btn btn-danger btn-sm">Delete</button>
            </form>
            <a href="{{ url_for('admin_routes.edit_task', task_id=task.id) }}" class="btn btn-primary btn-sm">Edit</a>
            <form action="{{ url_for('admin_routes.move_task', task_id=task.id) }}" method="POST" style="display:inline;">
                <select name="status" onchange="this.form.submit()">
                    <option value="Backlog" {% if task.status == 'Backlog' %} selected {% endif %}>Backlog</option>
                    <option value="In Progress" {% if task.status == 'In Progress' %} selected {% endif %}>In Progress</option>
                    <option value="Progressed" {% if task.status == 'Progressed' %} selected {% endif %}>Progressed</option>
                    <option value="Finished" {% if task.status == 'Finished' %} selected {% endif %}>Finished</option>
                </select>
            </form>
        </li>
        {% endfor %}
    </ul>

    <a href="{{ url_for('admin_routes.add_task', project_id=project.id) }}" class="btn btn-success">Add New Task</a>
{% endblock %}
